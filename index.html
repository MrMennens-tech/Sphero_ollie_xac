<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollie Web Controller</title>
    <!-- Manifest for PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e293b">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" href="img/favicon.ico">
    <style>
        /* General Styling */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        /* Status & Info Boxes */
        .status-box {
            display: flex;
            align-items: center;
            background-color: rgba(30, 41, 59, 0.8); /* slate-800 with opacity */
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        .status-dot {
            width: 1rem;
            height: 1rem;
            border-radius: 9999px;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }
        .status-dot.disconnected { background-color: #ef4444; } /* red-500 */
        .status-dot.connecting { background-color: #f59e0b; } /* amber-500 */
        .status-dot.connected { background-color: #22c55e; } /* green-500 */

        /* Buttons */
        .btn-secondary {
            background-color: #475569; /* slate-600 */
            color: #f8fafc; /* slate-50 */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.2s;
        }
        .btn-secondary:hover {
            background-color: #64748b; /* slate-500 */
            transform: scale(1.03);
        }

        .btn-touch {
            background-color: #334155; /* slate-700 */
            color: #f1f5f9; /* slate-100 */
            padding: 1rem;
            border-radius: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: background-color 0.2s, transform 0.2s;
        }
        .btn-touch:hover {
            background-color: #475569; /* slate-600 */
            transform: translateY(-2px);
        }

        .btn-config {
             background-color: #475569; /* slate-600 */
             color: white;
             padding: 0.75rem;
             border-radius: 0.5rem;
             font-weight: 500;
             transition: background-color 0.2s;
        }
        .btn-config:hover {
            background-color: #14b8a6; /* teal-500 */
        }

        /* Modal & Color Styling */
        input[type="color"] {
            -webkit-appearance: none;
            width: 100%;
            height: 2.5rem;
            border: none;
            padding: 0;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border-radius: 0.5rem;
            border: 2px solid #475569; /* slate-600 */
        }
    </style>
</head>
<body class="bg-slate-900 text-white font-sans flex flex-col min-h-screen">

    <header class="bg-slate-100 shadow-md p-4">
        <div class="container mx-auto flex justify-between items-center">
            <img src="img/logo_ms.png" alt="Logo Mytylschool" class="h-16">
            <h1 class="text-2xl sm:text-4xl font-bold text-slate-800 text-center">Ollie Web Controller</h1>
            <img src="img/logo_mt.png" alt="Logo Mennens.tech" class="h-16">
        </div>
    </header>

    <main class="container mx-auto p-4 flex-grow grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Left Column: Connection & Status & Main Toggles -->
        <div class="lg:col-span-1 bg-slate-800/50 rounded-2xl p-6 shadow-2xl flex flex-col gap-6 h-fit">
            <div id="connection-panel">
                <button id="connect-button" class="w-full text-center p-3 rounded-lg font-bold text-2xl py-4 transition-all transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 shadow-lg bg-teal-500 hover:bg-teal-600 text-slate-900">
                    Verbind met Ollie
                </button>
            </div>
            <div class="space-y-4">
                <div id="ollie-status-container" class="status-box">
                    <span id="ollie-status-dot" class="status-dot disconnected"></span>
                    <p id="ollie-status">Ollie: Niet verbonden</p>
                </div>
                <div id="gamepad-status-container" class="status-box">
                    <span id="gamepad-status-dot" class="status-dot disconnected"></span>
                    <p id="gamepad-status">Gamepad: Niet verbonden</p>
                </div>
            </div>

            <!-- Main Toggles & Config -->
            <div class="space-y-4 pt-4 border-t border-slate-700">
                <div class="flex items-center justify-between">
                    <label for="toggle-touch-checkbox" class="font-medium text-slate-300">Touch Modus</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggle-touch-checkbox" class="sr-only peer">
                        <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-focus:ring-4 peer-focus:ring-teal-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-600"></div>
                    </label>
                </div>
                <div class="flex items-center justify-between">
                    <label for="toggle-expert-checkbox" class="font-medium text-slate-300">Expert Modus</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggle-expert-checkbox" class="sr-only peer">
                        <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-focus:ring-4 peer-focus:ring-green-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                    </label>
                </div>
                <button id="open-config-button" class="btn-secondary w-full">Stel Controller In</button>
            </div>

            <button id="emergency-stop-button" class="hidden w-full text-center p-3 rounded-lg font-bold text-xl transition-all transform hover:scale-105 bg-red-600 hover:bg-red-500 text-white shadow-lg animate-pulse">
                NOODSTOP
            </button>
        </div>

        <!-- Middle Column: Touch Controls Panel -->
        <div id="touch-controls-panel" class="hidden lg:col-span-1 bg-slate-800/50 rounded-2xl p-6 shadow-2xl flex flex-col items-center justify-center gap-4">
            <div id="joystick-zone" class="relative w-48 h-48 rounded-full bg-slate-700/50"></div>
            <div class="grid grid-cols-2 gap-4 w-full">
                 <button data-action="speed-up" class="btn-touch">Snelheid +</button>
                 <button data-action="speed-down" class="btn-touch">Snelheid -</button>
            </div>
            <button data-action="cycle-mode" class="btn-touch w-full">Wissel Modus</button>
             <button id="touch-aim" class="btn-touch w-full">Richten</button>
            <div id="touch-tricks" class="hidden grid grid-cols-2 gap-4 w-full">
                <button data-trick="spinLeft" class="btn-touch">Spin Links</button>
                <button data-trick="spinRight" class="btn-touch">Spin Rechts</button>
                <button data-trick="flipForward" class="btn-touch">Flip Vooruit</button>
                <button data-trick="flipBackward" class="btn-touch">Flip Achteruit</button>
            </div>
        </div>

        <!-- Right Column: Info & Color Settings -->
        <div class="lg:col-span-1 bg-slate-800/50 rounded-2xl p-6 shadow-2xl flex flex-col gap-6 h-fit">
            <div id="info-panel" class="space-y-4">
                 <div id="mode-indicator" class="w-full text-center p-3 rounded-lg font-medium text-lg shadow-lg bg-slate-800">Modus: Normaal</div>
                 <div id="speed-indicator" class="w-full text-center p-3 rounded-lg font-medium text-lg shadow-lg bg-slate-800">Max Snelheid: 20%</div>
            </div>
            <div id="settings-panel" class="space-y-4">
                <div class="space-y-2 pt-4 border-t border-slate-700">
                    <h3 class="text-lg font-semibold text-center text-slate-300">Kleuren Knoppen</h3>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 items-center">
                         <label for="color-x1" class="text-center">X1 (A)</label><input type="color" id="color-x1" value="#ff0000">
                         <label for="color-x2" class="text-center">X2 (B)</label><input type="color" id="color-x2" value="#0000ff">
                         <label for="color-x3" class="text-center">X3 (X)</label><input type="color" id="color-x3" value="#00ff00">
                         <label for="color-x4" class="text-center">X4 (Y)</label><input type="color" id="color-x4" value="#ffff00">
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Config Modal -->
    <div id="config-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-2xl p-6 shadow-2xl w-full max-w-lg mx-4 space-y-6 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-teal-400">Controller Instellen</h2>
                <button id="close-config-button" class="text-slate-400 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <p id="config-instructions" class="text-center text-slate-400">Kies een actie en druk de gewenste knop/as in.</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <button data-action="SPEED_UP" id="map-SPEED_UP" class="btn-config">Snelheid +</button>
                <button data-action="SPEED_DOWN" id="map-SPEED_DOWN" class="btn-config">Snelheid -</button>
                <button data-action="COLOR_X1" id="map-COLOR_X1" class="btn-config">Kleur X1</button>
                <button data-action="COLOR_X2" id="map-COLOR_X2" class="btn-config">Kleur X2</button>
                <button data-action="COLOR_X3" id="map-COLOR_X3" class="btn-config">Kleur X3</button>
                <button data-action="COLOR_X4" id="map-COLOR_X4" class="btn-config">Kleur X4</button>
                <button data-action="SPEED_DOWN_ALT" id="map-SPEED_DOWN_ALT" class="btn-config">Snelheid - (Alt)</button>
                <button data-action="AIM_TOGGLE_RESET" id="map-AIM_TOGGLE_RESET" class="btn-config">Wissel Richten / Reset</button>
            </div>
             
            <div class="pt-4 border-t border-slate-700">
                 <h3 class="text-lg font-semibold text-center text-slate-300 mb-4">Joystick Assen</h3>
                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <button data-action="AXIS_X" id="map-AXIS_X" class="btn-config">Wijs X-As toe</button>
                    <button data-action="AXIS_Y" id="map-AXIS_Y" class="btn-config">Wijs Y-As toe</button>
                </div>
            </div>

             <div class="pt-4 border-t border-slate-700">
                <label for="deadzone-slider" class="block text-center text-slate-400 mb-2">Joystick Gevoeligheid</label>
                <input id="deadzone-slider" type="range" min="0.1" max="0.8" step="0.05" value="0.4" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
            </div>

        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.10.1/nipplejs.min.js"></script>
    <script src="js/ollie.js" type="module"></script>
    <script src="js/main.js" type="module"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>
</body>
</html>

